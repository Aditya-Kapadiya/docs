---
id: authentication
title: Authentication
sidebar_label: Authentication
slug: /authentication
---

# Authentication

## General

Services generated by Amplication contain authentication mechanisms based on the NestJS/Passport library.

## Authentication Plugins

Use plugins to support your choice of authentication method.

### NestJS Auth Module (mandatory)

The NestJS Auth Module plugin provides all the basic modules required for authentication of the service. Installation of this plugin is mandatory for the service to be authenticated, and must be installed together with the JWT Auth Provider plugin or the Basic Auth Provider plugin.

### JWT Auth Provider

[Passport](https://www.passportjs.org/) based JWT authentication involves the client sending a request to the server with a user's credentials in the form of a username and password. The server then authenticates the user and issues a JWT if the credentials are valid. This allows the client to authenticate subsequent requests to the server using the JWT. Read more about authentication [here](https://docs.nestjs.com/security/authentication).

:::tip

We recommend using JWT as a more secure alternative to Basic authentication.

:::

### Basic Auth Provider

Basic authentication is a simple authentication scheme built into the HTTP protocol that involves sending a request to a server with a user's credentials in the form of a username and password. The credentials are encoded in base64 and included in the Authorization header of the request.

## The User Entity

The _User_ entity **is required** in order for you to enable authentication on your service.

If you choose to [create a service _without_ authentication](#how-to-create-a-service-without-authentication) then the _User_ entity will not be created.

### How To Add The User Entity

First, go into your service's _Entities_ page.
Click on the **Add Entity** button in the top right hand corner.
Type `User` into the entity name text field and then click on the **Create Entity** button.

![Add a new User entity to your Amplication service](./assets/authentication/new_user_entity.png)

A popup will appear and give you additional context on restoring the _User_ entity.
Click on the **Restore Default** button and the original _User_ entity provided by Amplication will be restored.

:::note
You have to add the _User_ entity first and then enable the _NestJS Auth Module_ plugin.
It's not possible to do this in reverse order.
:::

### How To Delete The User Entity

Usually, it's possible to delete any Entity that you create on your service.
But, the _User_ entity is special.
In order to delete it, you must first disable the _NestJS Auth Module_.

:::caution
It's possible to restore the original _User_ entity provided by Amplication, but any additional fields or permissions you added will be permanently deleted.
:::

Follow these steps to delete the _User_ entity:

1. Visit your service's Plugins page and toggle the _NestJS Auth Module_ into the off state.

![Disable the NestJS Auth Module](./assets/authentication/disable_auth_plugin.png)

2. Visit your service's _Entities_ page.
You will notice that you can now click the _User_ entity's delete button. Click it and a popup will appear.

![Delete the User entity popup](./assets/authentication/delete_user_popup.png)

3. Click on the popup's **Delete** button. Now the User entity is deleted.

## JWT Authentication

When generating an app with JWT authentication, the process includes the following two steps:

1. Send a login request to the server with username and password to get back from the server the JWT token.
2. Add an authentication header with the JWT token to every consecutive request.

Following are examples of how to log in with REST API and GraphQL API.

### Rest API

```bash
curl -X 'POST' \
  'https://[server-url]/api/login' \
  -H 'accept: */*' \
  -H 'Content-Type: application/json' \
  -d '{
  "username": "admin",
  "password": "admin"
}'
```

![Swagger playground for login endpoint.](./assets/authentication/auth-rest.png)

### GraphQL API

```graphql
mutation {
  login(credentials: { username: "admin", password: "admin" }) {
    accessToken
  }
}
```

### Header with JWT Included (example)

<!-- spell-checker: disable -->

```text
 Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjoieW91IGFyZSBzb29vb28gY29vbCB0aGF0IHlvdSBjaGVjayB0aGF0ISIsIm5hbWUiOiJPZmVrIGdhYmF5IDspIiwiaWF0IjoxNTE2MjM5MDIyfQ.vaYJaP9SUlOU0u4NfFCRm5tmBVDKeCwvN6ByCkqJt8U
```

<!-- spell-checker: enable -->

## Basic Authentication

When using Basic HTTP authentication, when sending a request to the API you must provide a Basic HTTP authentication header with the format:

Authorization: 'type' 'credentials'

where type is Basic and credentials is the Base64 encoding of a string "username:password".

**For example:**

```text
Authorization: Basic YWRtaW46YWRtaW4=
```

By default, your app comes with one user with the username "admin" and password "admin".

:::tip

You can use a tool to create the header. There are several generators available, such as [https://www.blitter.se/utils/basic-authentication-header-generator/](https://www.blitter.se/utils/basic-authentication-header-generator/)

:::

Read here to find out more: [HTTP authentication](https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication).

## How To Uninstall Auth Plugins After Pushing To GitHub

If you choose to uninstall auth plugins after pushing it to GitHub, the changes may not be reflected in the customizable files (files that are not in the base folder), and you will receive the following compilation errors:

![](./assets/uninstall-auth-plugins.png)

You need to fix it manually, as follows:

- Remove imports from files that do not exist, for example: `../auth/gqlDefaultAuth.guard`
- Remove the `rolesBuilder` from the `super()` in the constructor (in each entity controller/resolver).

## Custom Authentication with Passport

You can further develop the code generated by Amplication to rollout your own authentication system.

Amplication uses the `@nestjs/passport` module as middleware to support authentication. `Passport` is a popular `node.js` authentication library, widely used by the community.

Passport supports many authentication strategies available as `npm` modules, which you can implement in your generated project. You can easily integrate the library with a `Nest` application using the [`@nestjs/passport`](https://docs.nestjs.com/security/authentication) module.

Passport has a rich ecosystem of [strategies](https://www.passportjs.org/concepts/authentication/strategies/) that implement various authentication mechanisms.

##  How To Create A Service Without Authentication

When you are creating your service using our service creation onboarding wizard, you can optionally choose to [create a service _without_ authentication](/first-service/#step-7-include-authentication-optional).

This is useful for a public-facing service that does not handle sensitive or personal information and you wish to enable access to anyone without the need for a login or password. Typical use cases include displaying public information, such as a public event or a weather forecast, and returning search results from a public database.

Alternatively, this might be useful when you need background services that don't expose endpoints to end users. The service may be part of a larger system where authentication is handled at a different level, such as a gateway or reverse proxy. Typical use cases include where an organization’s internal services communicate with each other, and public facing APIs that do not require authentication.

To create a service without authentication, do not install the authentication plugins.
